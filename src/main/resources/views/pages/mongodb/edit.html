<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>mongodb web版查询功能</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
		<link rel="stylesheet" href="../../static/css/font.css">
		<link rel="stylesheet" href="../../static/css/weadmin.css">
		<!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
		<!--[if lt IE 9]>
	      <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
	      <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
	    <![endif]-->
	    <style>
			    pre { padding: 5px; margin: 5px; }
			    .string { color: green; }
			    .number { color: darkorange; }
			    .boolean { color: blue; }
			    .null { color: magenta; }
			    .key { color: red;font-size: 14px; }
			    .collection{width: 800px;border: 1px solid #ccc;display: block;border-radius:5px;margin-top: 20px;}
		</style>
	</head>

	<body>
		<div class="weadmin-body">
			<div class="layui-btn-group">
				 <button class="layui-btn"><i class="layui-icon">&#xe608;</i> 添加</button>
				 <button class="layui-btn"><i class="layui-icon">&#xe641;</i>导出</button>
	       </div>
       		<!-- 集合数据列表 -->
			<div class="collection">
				<pre class="result"></pre>
				<div class="layui-btn-group">
				  <button class="layui-btn layui-btn-normal">编辑</button>
				  <button class="layui-btn layui-btn-danger">删除</button>
				</div>
			</div>
		   <div id="page"></div>
		</div>
		<script src="../../lib/layui/layui.js" charset="utf-8"></script>
		<script type="text/javascript" src="../../js/config.js?v=1" charset="utf-8"></script>
		<script type="text/javascript">
			layui.extend({
				admin: '{/}../../static/js/admin'
			});
			layui.use(['form', 'jquery', 'admin','layer','laypage'], function() {
				var form = layui.form,
					$ = layui.jquery,
					admin = layui.admin,
					layer = layui.layer;
				    laypage = layui.laypage; 
				    var count = 0;
				    //分页
			        laypage.render({
			            elem: 'page'
			            , count: count //数据总数，从服务端得到
			            , jump: function (obj, first) {
			                //首次不执行
			                if (!first) {
			                    console.log("首次不执行");
			                    frameVal(1);
			                }
			            }
			        });
				    
				//页面初始化加载
				$(function(){
					setTimeout(function(){
						frameVal(1);
					},100);
				});  
	
			    
				function frameVal(p){
					 var obj=urlToJSON();
					  $.ajax({
				            url: baseURl+"/mongo/getCollection",
				            dataType: "json",
				            type: "post",
				            async: false,
				            data: {"tableName": obj.tableName,"dbName":obj.dbName,"p": p},
				            success: function (data) {
				     
				            	$('.result').html(syntaxHighlight(data.data.data));
				                if (data.code == 0) {
				                    obj = data.obj;
				                    count = data.data.totalCount;
				                    $.each(data.data.data, function (index, obj) {
				                        var html = "<tr>";
				                        $.each(data.keys, function (index2, key) {
				                            html += "<td>" + obj[key] + "</td>";
				                        })
				                        $("#list").append(html);
				                        html += "</tr>"
				                    });
				                }
				            },
				        });
				}
				//监听提交
				form.on('submit(add)', function(data) {
					console.log(data);
					//发异步，把数据提交给php
					layer.alert("增加成功", {
						icon: 6
					}, function() {
						// 获得frame索引
						var index = parent.layer.getFrameIndex(window.name);
						//关闭当前frame
						parent.layer.close(index);
					});
					return false;
				});

			});
		</script>
	</body>

</html>